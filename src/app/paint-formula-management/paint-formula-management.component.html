<div class="container">
  <h2>Paint Formula Management</h2>

  <!-- ✅ ONE FORM WRAPPING EVERYTHING -->
  <form [formGroup]="formulaForm">

    <!-- Paint Details -->
    <div class="form-row">
      <div class="form-group">
        <label>Paint Name</label>
        <input type="text" formControlName="paintName">
      </div>

      <div class="form-group">
        <label>Batch Size</label>
        <input type="number" formControlName="batchSize">
      </div>

      <div class="form-group">
        <label>Batch Unit</label>
        <select formControlName="batchUnit">
          <option value="LITERS">Liters</option>
          <option value="KG">Kg</option>
        </select>
      </div>
    </div>

    <!-- Formula Table -->
    <table>
      <thead>
        <tr>
          <th>Raw Material</th>
          <th>Quantity</th>
          <th>Unit</th>
          <th>Notes</th>
          <th>❌</th>
        </tr>
      </thead>

      <tbody formArrayName="items">
        <tr *ngFor="let item of items.controls; let i = index"
            [formGroupName]="i">

          <td>
            <select formControlName="rawMaterialId">
              <option value="">Select Material</option>
              <option *ngFor="let rm of rawMaterials" [value]="rm.id">
                {{ rm.name }}
              </option>
            </select>
          </td>

          <td>
            <input type="number" formControlName="quantity">
          </td>

          <td>
            <select formControlName="unit">
              <option *ngFor="let u of units" [value]="u">
                {{ u }}
              </option>
            </select>
          </td>

          <td>
            <textarea formControlName="notes"></textarea>
          </td>

          <td>
            <button
              type="button"
              class="btn btn-danger"
              (click)="removeItem(i)"
              [disabled]="items.length === 1">
              X
            </button>
          </td>

        </tr>
      </tbody>
    </table>

    <div class="add-row">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="addItem()">
        + Add Raw Material
      </button>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button
        type="button"
        class="btn btn-primary"
        [disabled]="formulaForm.invalid"
        (click)="save()">
        Save Formula
      </button>
    </div>

  </form>
</div>